<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKSL ì…°ì´ë” êµìœ¡ ìë£Œ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <h1>ğŸ¨ SKSL ì…°ì´ë” êµìœ¡ ìë£Œ</h1>
        <p>Chapter 7. ë©€í‹° íŒ¨ìŠ¤</p>

        <nav class="chapter-nav">
            <a href="index.html" class="chapter-btn">0. ê¸°ë³¸ í•¨ìˆ˜ ì„¤ëª…</a>
            <a href="chapter1.html" class="chapter-btn">1. ê¸°ë³¸ ë„í˜•ê³¼ íŒ¨í„´</a>
            <a href="chapter2.html" class="chapter-btn">2. ê¸°ë³¸ ë„í˜• íšŒì „ ì´ë™ í™•ëŒ€</a>
            <a href="chapter3.html" class="chapter-btn">3. ëœë¤ í•¨ìˆ˜ì™€ ë…¸ì´ì¦ˆ í•¨ìˆ˜</a><br>
            <a href="chapter4.html" class="chapter-btn">4. Fractal</a>
            <a href="chapter5.html" class="chapter-btn">5. ì´ë¯¸ì§€ í•„í„°ë§ ë° ì»¬ëŸ¬ ì»¤ë¸Œ</a>
            <a href="chapter6.html" class="chapter-btn">6. ë¸”ëŸ¬ ì•Œê³ ë¦¬ì¦˜</a>
            <a href="chapter7.html" class="chapter-btn active">7. ë©€í‹°íŒ¨ìŠ¤ í…ŒìŠ¤íŠ¸</a>
        </nav>
    </div>

    <div class="container">
        <div class="lesson">
            <div class="lesson-header">
                <div class="lesson-title">ë©€í‹° íŒ¨ìŠ¤ í…ŒìŠ¤íŠ¸</div>
                <div class="lesson-description">
                    <h3>í•™ìŠµ ëª©í‘œ</h3>
                    4-Pass ì‹œìŠ¤í…œì„ í™œìš©í•œ ê³ ê¸‰ ì´ë¯¸ì§€ ì²˜ë¦¬<br>
                    Pass 1: ì›ë³¸ ì´ë¯¸ì§€ â†’ Pass 2: ìˆ˜í‰ ë¸”ëŸ¬ â†’ Pass 3: ìˆ˜ì§ ë¸”ëŸ¬ â†’ Pass 4: ìµœì¢… í›„ì²˜ë¦¬<br>
                </div>
            </div>

            <div class="key-concepts">
                <div class="concepts-header" onclick="toggleConcepts('concepts5')">
                    <h4>4-Pass ì…°ì´ë” ì‹œìŠ¤í…œ</h4><br>            
                    <span class="toggle-icon" id="icon-concepts5">â–¼</span>
                </div>        
                <div class="concepts-content" id="concepts5">        
                    <ul><br>
                    ìµœëŒ€ 4ê°œì˜ íŒ¨ìŠ¤ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ë²”ìš© ì‹œìŠ¤í…œì…ë‹ˆë‹¤.<br>
                    ê° Passì˜ ê²°ê³¼ê°€ ë‹¤ìŒ Passì˜ ì…ë ¥(iTexture)ìœ¼ë¡œ ìë™ ì „ë‹¬ë©ë‹ˆë‹¤.<br>
                    ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬, ì»¨ë³¼ë£¨ì…˜, ì´ë¯¸ì§€ íš¨ê³¼ ë“± ë‹¤ì–‘í•œ ìš©ë„ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
                    compile2Pass(), compile3Pass(), compile4Pass() í•¨ìˆ˜ë¡œ ì›í•˜ëŠ” ê°œìˆ˜ë§Œí¼ ì‹¤í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br><br>
                    </ul>                  
                </div>
            </div>

            <!-- Pass 1 -->
            <div class="lesson-content">
                <div class="editor-section">
                    <div class="section-header">Pass 1 ì…°ì´ë” (ì›ë³¸ ì´ë¯¸ì§€)</div>
                    <textarea class="code-editor" id="editor_pass_1" rows="15">uniform shader iTexture;
uniform float2 iResolution;

half4 main(float2 fragCoord) {
    // return iTexture.eval(fragCoord);

    float  scale = 4.;           // ë‹¤ìš´ìŠ¤ì¼€ì¼ ë°°ìœ¨ (2.0 = 1/2, 4.0 = 1/4)
    float2 srcCoordCenter = (fragCoord + 0.5) * scale;
    
    // 2x2 ë°•ìŠ¤ í•„í„° (ì•ˆí‹°ì•¨ë¦¬ì–´ì‹±)
    half4 c00 = iTexture.eval(srcCoordCenter + float2(-0.5 * scale, -0.5 * scale));
    half4 c10 = iTexture.eval(srcCoordCenter + float2( 0.5 * scale, -0.5 * scale));
    half4 c01 = iTexture.eval(srcCoordCenter + float2(-0.5 * scale,  0.5 * scale));
    half4 c11 = iTexture.eval(srcCoordCenter + float2( 0.5 * scale,  0.5 * scale));
    
    // 4ê°œ ìƒ˜í”Œì˜ í‰ê· 
    return (c00 + c10 + c01 + c11) * 0.25;
}</textarea>
                </div>

                <div class="preview-section">
                    <div class="section-header">Pass 1 ê²°ê³¼</div>
                    <div id="error2"></div>
                    <div class="preview-container">
                        <div class="loading" id="loading2">CanvasKit ë¡œë”© ì¤‘...</div>
                        <canvas class="preview-canvas" id="canvas2" width="300" height="300" style="display: none;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Pass 2 -->
            <div class="lesson-content">
                <div class="editor-section">
                    <div class="section-header">Pass 2 ì…°ì´ë” (Horizontal Blur)</div>
                    <textarea class="code-editor" id="editor_pass_2" rows="20">uniform shader iTexture;
uniform float2 iResolution;
uniform float blurRadius;

float gaussian(float x, float sigma) {
    return exp(-(x*x) / (2.0 * sigma * sigma)) / (sqrt(2.0 * 3.14159265) * sigma);
}

half4 main(float2 fragCoord) {
    const int MAX_RADIUS = 200;
    float r = clamp(blurRadius, 0.0, float(MAX_RADIUS));
    float sigma = max(r, 1.0) * 0.33;
    
    half4 color = half4(0.0);
    float totalWeight = 0.0;
    
    for (int x = -MAX_RADIUS; x <= MAX_RADIUS; ++x) {
        float2 off = float2(float(x), 0.0);
        float dist = abs(float(x));
        if (dist > r) continue;

        float w = gaussian(dist, sigma);
        color += iTexture.eval(fragCoord + off) * w;
        totalWeight += w;
    }
    return color / max(totalWeight, 1e-6);
}</textarea>
                </div>

                <div class="preview-section">
                    <div class="section-header">Pass 2 ê²°ê³¼ (ìˆ˜í‰ ë¸”ëŸ¬)</div>
                    <div id="error3"></div>
                    <div class="preview-container">
                        <div class="loading" id="loading3">CanvasKit ë¡œë”© ì¤‘...</div>
                        <canvas class="preview-canvas" id="canvas3" width="300" height="300" style="display: none;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Pass 3 -->
            <div class="lesson-content">
                <div class="editor-section">
                    <div class="section-header">Pass 3 ì…°ì´ë” (Vertical Blur)</div>
                    <textarea class="code-editor" id="editor_pass_3" rows="20">uniform shader iTexture;
uniform float2 iResolution;
uniform float blurRadius;

float gaussian(float x, float sigma) {
    return exp(-(x*x) / (2.0 * sigma * sigma)) / (sqrt(2.0 * 3.14159265) * sigma);
}

half4 main(float2 fragCoord) {
    const int MAX_RADIUS = 200;
    float r = clamp(blurRadius, 0.0, float(MAX_RADIUS));
    float sigma = max(r, 1.0) * 0.33;
    
    half4 color = half4(0.0);
    float totalWeight = 0.0;
    
    for (int y = -MAX_RADIUS; y <= MAX_RADIUS; ++y) {
        float2 off = float2(0.0, float(y));
        float dist = abs(float(y));
        if (dist > r) continue;

        float w = gaussian(dist, sigma);
        color += iTexture.eval(fragCoord + off) * w;
        totalWeight += w;
    }
    return color / max(totalWeight, 1e-6);
}</textarea>
                </div>

                <div class="preview-section">
                    <div class="section-header">Pass 3 ê²°ê³¼ (ìµœì¢… ë¸”ëŸ¬)</div>
                    <div id="error4"></div>
                    <div class="preview-container">
                        <div class="loading" id="loading4">CanvasKit ë¡œë”© ì¤‘...</div>
                        <canvas class="preview-canvas" id="canvas4" width="300" height="300" style="display: none;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Pass 4 -->
            <div class="lesson-content">
                <div class="editor-section">
                    <div class="section-header">Pass 4 ì…°ì´ë” (í›„ì²˜ë¦¬)</div>
                    <textarea class="code-editor" id="editor_pass_4" rows="15">uniform shader iTexture;
uniform float2 iResolution;
uniform float blurRadius;

half4 main(float2 fragCoord) {
    // return iTexture.eval(fragCoord);
    float scale = 4.0;
    
    // ë‹¤ìš´ìŠ¤ì¼€ì¼ëœ í…ìŠ¤ì²˜ ì¢Œí‘œ
    float2 downscaledCoord = fragCoord / scale;
    
    // ë°”ì´ë¦¬ë‹ˆì–´ ë³´ê°„ì„ ìœ„í•œ 4ê°œ ìƒ˜í”Œ
    float2 baseCoord = floor(downscaledCoord);
    float2 frac = fract(downscaledCoord);
    
    half4 c00 = iTexture.eval(baseCoord + float2(0.0, 0.0));
    half4 c10 = iTexture.eval(baseCoord + float2(1.0, 0.0));
    half4 c01 = iTexture.eval(baseCoord + float2(0.0, 1.0));
    half4 c11 = iTexture.eval(baseCoord + float2(1.0, 1.0));
    
    // ë°”ì´ë¦¬ë‹ˆì–´ ë³´ê°„
    half4 c0 = mix(c00, c10, frac.x);
    half4 c1 = mix(c01, c11, frac.x);
    return mix(c0, c1, frac.y);
}</textarea>
                </div>

                <div class="preview-section">
                    <div class="section-header">Pass 4 ê²°ê³¼ (ìµœì¢… ì¶œë ¥)</div>
                    <div id="error5"></div>
                    <div class="preview-container">
                        <div class="loading" id="loading5">CanvasKit ë¡œë”© ì¤‘...</div>
                        <canvas class="preview-canvas" id="canvas5" width="300" height="300" style="display: none;"></canvas>
                    </div>
                </div>
            </div>

            <!-- ì»¨íŠ¸ë¡¤ -->
            <div class="lesson-content">
                <div class="editor-section">
                    <div class="controls">
                        <button class="btn" onclick="compile4Pass()">Multi-Pass ì‹¤í–‰</button>
                    </div>
                    <div style="padding: 10px; background-color: #494949; border-radius: 4px; margin-top: 10px;">
                        <label for="radiusSlider_multipass" style="display: inline-block; width: 100px; color: #fff;">Blur Radius:</label>
                        <input type="range" id="radiusSlider_multipass" min="0" max="200" value="5" step="0.5" 
                            style="width: 200px; vertical-align: middle;"
                            oninput="updateMultiPassRadius(this.value)">
                        <span id="radiusValue_multipass" style="display: inline-block; width: 50px; margin-left: 10px; color: #fff; font-weight: bold;">5.0</span>
                    </div>
                    <div style="padding: 10px; margin-top: 10px; background-color: #2a2a2a; border-radius: 4px; color: #aaa; font-size: 0.9em;">
                        íŒ: Ctrl+Enterë¡œ ì…°ì´ë” ì¬ì»´íŒŒì¼, Ctrl+Rë¡œ í…ìŠ¤ì²˜ ìƒˆë¡œê³ ì¹¨
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        function toggleConcepts(conceptsId) {
            const content = document.getElementById(conceptsId);
            const icon = document.getElementById(`icon-${conceptsId}`);
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                content.style.maxHeight = content.scrollHeight + 'px';
                icon.textContent = 'â–²';
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('collapsed');
                content.style.maxHeight = '0';
                icon.textContent = 'â–¼';
                icon.style.transform = 'rotate(0deg)';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const sectionsToClose = ['concepts5'];
            
            sectionsToClose.forEach(conceptsId => {
                const content = document.getElementById(conceptsId);
                const icon = document.getElementById(`icon-${conceptsId}`);
                const header = document.querySelector(`[onclick="toggleConcepts('${conceptsId}')"]`);
                
                if (content) {
                    content.classList.add('collapsed');
                    content.style.maxHeight = '0';
                }
                if (icon) {
                    icon.textContent = 'â–¼';
                }
                if (header) {
                    header.classList.add('closed');
                }
            });
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/canvaskit-wasm/0.38.0/canvaskit.min.js"></script>
    <script src="shader-tutorial.js"></script>
</body>
</html>