<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKSL 셰이더 교육 자료</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <h1> SKSL 셰이더 교육 자료</h1>
        <p>Chapter 1. 주요 함수 및 기본 도형 그리기 </p>

        <nav class="chapter-nav">
            <a href="index.html" class="chapter-btn active">Chapter 1. 기본 함수 및 기본 도형 그리기 </a>
            <a href="chapter2.html" class="chapter-btn">Chapter 2. 랜덤 함수와 노이즈 함수 </a>
            <a href="chapter3.html" class="chapter-btn">Chapter 3. 이미지 필터링 및 활용 알고리즘 </a>
        </nav>
    </div>

    <div class="container">
        <div class="lesson">
            <div class="lesson-header">
                <div class="lesson-title"> 자주 사용하는 함수를 사용해보자. </div>
                <div class="lesson-description">
                    <h3> 학습 목표</h3>                    
                    아래 사이트는 기본 API Document 주소 입니다. 옆에 띄워주세요 <br>
                    https://thebookofshaders.com/glossary/ <br><br>

                    1) step, smoothstep, fract, mod, abs, square, sqrt, sin, cos, tan, exp 그래프를 손으로 그려볼 수 있다. <br>
                    float y 값에 원하는 아래 수식을 넣어보고 어떻게 그려지는지 확인하세용! <br><br>

                    2) 그래프 정규화 영역은 -1 ~ 1 입니다. <br>
                    좌표 정규화는 가장 기본적이고 중요한 내용입니다. <br>
                    아래 내용을 테스트 해보시고 xy -4 ~ 4 정규화 하고 원점을 중앙으로 맞추어 보세요. <br><br>

                    3) 스키아 좌표계는 Y 좌표가 반대 입니다. <br>
                    이해를 돕기 위해 uv.y = 1.0 - uv.y; // Skia 좌표계 y축 반전 코드를 추가해 주세요<br><br>

                    4) Uv += 값을 더하게 빼는 경우, 시각적으로 반대로 보입니다.
                </div>
            </div>
            
            <div class="key-concepts">
                <div class="concepts-header" onclick="toggleConcepts('concepts1')">
                    <h4> 자주 사용하는 함수 및 그래프 ( 라이브러리 포함 )</h4>
                    <span class="toggle-icon" id="icon-concepts1">▼</span>
                </div>
                <div class="concepts-content" id="concepts1">
                    <ul>
                        <li><strong>1. 직선:</strong><br>
                            <div class="code-example">
                                <code>float y = p.x;</code>
                            </div>
                        </li>

                        <li><strong>3. Clamp 곡선 : </strong><br>
                            <div class="code-example">
                                <code>float y = clamp(p.x, 0, 1);</code>
                            </div>
                        </li>
                        
                        <li><strong>4. Step (계단 그래프):</strong><br>
                            <div class="code-content" id="step-code">
                                <div class="code-example">
                                    <code>float y = step(0.5, p.x);
//if (p.x < -0.3 && p.x > -0.5) y = .3;
//if (p.x > 0.3 && p.x < 0.5) y = .6;
</code>
                                </div>
                            </div>
                        </li>
                        
                        <li><strong>4.1. SmoothStep:</strong><br>
                            <div class="code-example">
                                <code>float y = smoothstep(0.0, 1.0, p.x);<br>p.x = clamp(p.x, 0, 1);<br>float y = p.x * p.x * (3.0 - 2.0 * p.x);</code>
                            </div>
                        </li>

                        <li><strong>3. Fract 곡선 (톱니파 모양):</strong><br>
                            <div class="code-example">
                                <code>float y = fract(sin(p.x);</code>
                            </div>
                            <em>fract(-1.3) = -2.0 + 0.7<br>fract(1.3) = 1.0 + 0.3</em>
                        </li>

            
                        <li><strong>4. Floor :</strong><br>
                            <div class="code-example">
                                <code>p *= 3.0;<br>float y = floor(p.x);</code>
                            </div>
                        </li>

                        <li><strong>5. Dot :</strong><br>
                            <div class="code-example">
                                <code>p *= 3.0;<br>float y = dot(p.x, p.y);</code><br>
                                // dot (vec2(a, b), vec2(c, d)) = a * c + b * d = 스칼라 값. <중요>
                                // 그래프이상한데?
                            </div>
                        </li>
                        

                        <li><strong>4. mod:</strong><br>
                            <div class="code-example">
                                <code>float y = mod(p.x, 0.5);</code>
                            </div>
                        </li>

                        <li><strong>6. 절대값 곡선 (대칭):</strong><br>
                            <div class="code-example">
                                <code>float y = abs(p.x);</code>
                            </div>
                        </li>
                        
                        <li><strong>7. 제곱 곡선:</strong><br>
                            <div class="code-example">
                                <code>float y = p.x * p.x;</code>
                            </div>
                        </li>
                        
                        <li><strong>8. 제곱근:</strong><br>
                            <div class="code-example">
                                <code>float y = sqrt(p.x);</code>
                            </div>
                        </li>

                        <li><strong>2. 사인 곡선:</strong><br>
                            <div class="code-example">
                                <code>p.x *= 3.14;<br>float y = sin(p.x);</code>
                            </div>
                        </li>

                        <li><strong>9. 코사인:</strong><br>
                            <div class="code-example">
                                <code>p.x *= 3.14;<br>float y = cos(p.x);</code>
                            </div>
                        </li>
                        
                        <li><strong>10. 탄젠트:</strong><br>
                            <div class="code-example">
                                <code>p.x *= 3.14;<br>float y = tan(p.x);</code>
                            </div>
                        </li>
                        
                        <li><strong>5. 가우시안 곡선:</strong><br>
                            <div class="code-example">
                                <code>float y = exp(-p.x * p.x);</code>
                            </div>
                        </li>
                        
                        <li><strong>11. Triangular Wave (지그재그):</strong><br>
                            <div class="code-example">
                                <code>float y = abs(fract(p.x) * 2.0 - 1.0);</code>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="key-concepts">
                <div class="concepts-header" onclick="toggleConcepts('concepts5')">
                    <h4> 좌표계 정규화 방법 </h4><br>                    
                    <span class="toggle-icon" id="icon-concepts5">▼</span>
                </div>
                <div class="concepts-content" id="concepts5">
                    <ul>
                        Skia 좌표계는 Y축이 위에서 아래로 갈수록 커지기 때문에 y축 반전을 해준다. <br>
                        아래 코드는 자주 사용 될듯... <br>
                        <div class="code-example">                     
<code>0 ~ 1 좌표계 정규화 --> uv = fragCoord / iResolution.xy; 
종횡비 보정 --> uv.y *= iResolution.y / iResolution.x;
Skia y축 반전 --> uv.y = 1.0 - uv.y; // Skia 좌표계 y축 반전
원점으로 좌표계 정규화 --> uv -= .5;</code>
                        </div>

                        <li><strong> 0 - 1 정규화 </strong><br>
                            <div class="code-example">                     
<code>uv = fragCoord / iResolution;
uv.y = 1.0 - uv.y; // Skia 좌표계 y축 반전
float y = p.x;
if (uv.x > .5) y = 0.;
</code>
                            </div>
                        </li>
                        <li><strong> -.5 ~ .5 정규화 </strong><br>
                            <div class="code-example">
<code>uv = fragCoord / iResolution;
uv.y = 1.0 - uv.y; // Skia 좌표계  y축 반전
uv -= .5;
float y = p.x;
if (uv.x > .3 || uv.x < -.3) y = 0.;
</code>
                            </div>
                        </li>
                        <li><strong> xy 종횡비 맞추기 </strong><br>
                            <div class="code-example">
<code>uv = fragCoord / iResolution;
uv.y *= iResolution.y / iResolution.x;
uv.y = 1.0 - uv.y; // Skia 좌표계 y축 반전
uv -= .5;
float y = p.x;
if (uv.x > .3 || uv.x < -.3) y = 0.;
</code>
                            </div>
                        </li>                        
                    </ul>
                </div>
            </div>

            <div class="lesson-content">
                <div class="editor-section">
                    <div class="section-header">SKSL 실습 코드</div>
                    <textarea class="code-editor" id="editor1">
float y = p.x;           
                    </textarea>
                    <div class="controls">
                        <button class="btn" onclick="compileShader(1)"> 실행</button>                     
                    </div>
                </div>
                
                <div class="preview-section">
                    <div class="section-header">미리보기</div>
                    <div id="error1"></div>
                    <div class="preview-container">
                        <div class="loading" id="loading1">CanvasKit 로딩 중...</div>
                        <canvas class="preview-canvas" id="canvas1" width="300" height="300" style="display: none;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="lesson">
            <div class="lesson-header">
                <div class="lesson-title"> 패턴 만들기</div>
                <div class="lesson-description">
                    <h3> 학습 목표</h3>
                    패턴 모양일때 반복되는 구간의 x,y 값을 알 수 있다.(fract, floor)<br>
                    손으로 영역을 그려보자, 헷갈리는 경우 대표하는 픽셀만 구해서 생각하자<br>
                    복잡한 코드를 분석하는 방법을 배울수 있다. <br><br>
                    원과 사각형 코드를 수정해서 함수를 변경 해보세요 (step->smoothstep) <br>
                    상수에 목숨걸지말자 <br>

                    <h3> 코드 분석 방법</h3>                        
                    1) 정규화 파악 (0 ~ 1), (-0.5 ~ 0.5)<br>
                    2) 코드 분해해서 주석 처리<br>
                    3) 간단한 함수로 바꾸어 보기 (smoothstep → step)<br>
                    4) 경계를 파악하고 경계를 파악 후 그려보기<br>
                </div>
            </div>
            
            <div class="key-concepts">
                <div class="concepts-header" onclick="toggleConcepts('concepts2')">
                    <h4>원 만들기</h4>
                    <span class="toggle-icon" id="icon-concepts2">▼</span>
                </div>
                <div class="concepts-content" id="concepts2">
                    <ul>
                        <li><strong>원리</strong><br>
                        <img src="materials/chapter1/circle.png" alt="circle" style="max-width: 100%; height: auto; margin-bottom: 10px;">
                        <li><strong>정규화</strong><br>
                            <div class="code-example">
                                <code>float2 uv = fragCoord / iResolution.xy;</code>
                            </div>
                        </li>
                        
                        <li><strong>원을 만드는 코드 1</strong>                            
                                <div class="code-example">
                                    <code>uniform float2 iResolution;
float circle(in vec2 _st, in float _radius) { 
    vec2 l = _st - vec2(0.5);
    return 1. - step(_radius, dot(l, l) * 2.0);
}
half4 main(float2 fragCoord) {
    float2 uv = fragCoord / iResolution.xy;    
    float color = circle(uv, 0.3);
    return half4(color, color, color, 1.0);
}</code>
                            </div>
                        </li>

                        <li><strong>원을 만드는 코드 2</strong>                            
                            <div class="code-example">
                                <code>uniform float2 iResolution;
float circle(in vec2 _st, in float _radius) {     
    float edge0 = _radius - (_radius * 0.01);
    float edge1 = _radius + (_radius * 0.01);
    return 1. - smoothstep(edge0, edge1, sqrt(dot(_st, _st)));
}
half4 main(float2 fragCoord) {
    float2 uv = fragCoord / iResolution.xy  - .5;
    float color = circle(uv, 0.3);
    return half4(color, color, color, 1.0);
}</code>
                            </div>
                        </li>

                        <li><strong>원을 만드는 코드 3</strong>                                                        
                            <div class="code-example">
                                <code>uniform float2 iResolution;
float circle(in vec2 _st, in float _radius) {     
    return 1. - smoothstep(_radius - (_radius * 0.01), 
                          _radius + (_radius * 0.01), 
                          dot(_st, _st) * 2.0);
}
half4 main(float2 fragCoord) {
    float2 uv = (fragCoord / iResolution.xy) - .5;    
    float color = circle(uv, 0.3);
    return half4(color, color, color, 1.0);
}</code>                             
                            </div>
                        </li>        
                    </ul>
                </div>
            </div>

            <div class="key-concepts">
                <div class="concepts-header" onclick="toggleConcepts('concepts3')">
                    <h4> 박스 만들기 </h4>
                    <span class="toggle-icon" id="icon-concepts3">▼</span>
                </div>
                <div class="concepts-content" id="concepts3">
                    <li><strong>원리</strong><br>
                        <li><strong>p.x * p.y 의미는 x, y 둘다 1인 영역만 1로, 나머지 0 </strong><br>
                        <li><strong>아래 그림은 step(dl, pt)와 (1. - step(ur, pt)) 를 나타낸 것이다. </strong><br>
                    </li>
                    <ul>
                        <img src="materials/chapter1/box1.png" alt="circle" style="max-width: 100%; height: auto; margin-bottom: 10px;">
                        <img src="materials/chapter1/box2.png" alt="circle" style="max-width: 100%; height: auto; margin-bottom: 10px;">
                        <img src="materials/chapter1/box3.png" alt="circle" style="max-width: 100%; height: auto; margin-bottom: 10px;">
                        <li><strong> 벡터 연산 팁</strong>
                            <div class="code-example">
                                <code>
float rect(vec2 pt, vec2 size, vec2 center) {
    vec2 dl = center - (size * 0.5);
    vec2 ur = center + (size * 0.5);
    vec2 result = step(dl, pt) * (1.0 - step(ur, pt));
    return result.x * result.y;
}
uniform float2 iResolution;
vec4 main(vec2 fragCoord) {
    vec2 uv = fragCoord / iResolution.xy; 
    uv.y *= iResolution.y / iResolution.x;  // 종횡비 보정
    uv.y = 1.0 - uv.y;
    uv -= .5; // -.5 ~ .5 정규화

    vec2 size = vec2(0.2, 0.2);
    vec2 center = vec2(0., 0.);
    vec3 color = vec3(1.0, 1.0, 0.0) * rect(uv, size, center);
    return vec4(color, 1.0);
}
    
                                </code>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="key-concepts">
                <div class="concepts-header" onclick="toggleConcepts('concepts4')">
                    <h4> 패턴 만들기 </h4>
                    <span class="toggle-icon" id="icon-concepts4">▼</span>
                </div>
                <div class="concepts-content" id="concepts4">
                    <ul>
                        <img src="materials/chapter1/pattern.png" alt="circle" style="max-width: 100%; height: auto; margin-bottom: 10px;">
                        <li><strong>기본 패턴 만들기 </strong>

                            <div class="code-example">
                                <code>uniform float2 iResolution;
half4 main(float2 fragCoord) {
    float2 uv = (fragCoord / iResolution.xy);    
    uv *= 3.0;
    uv = fract(uv);
    float3 color = float3(uv, 0.0);
    return half4(color, 1.0);
}</code>                            
                            </div>
                        </li>
                        <li><strong>박스 패턴 만들기</strong>      
                            <li><strong> p.x * p.y를 출력하면, 둘다 1인 영역만 출력 !! </strong></li>               
                            <div class="code-example">                                
<code>vec2 tile(vec2 _st, float _zoom) {
    _st *= _zoom;
    return fract(_st);
}

float box(vec2 _st, vec2 _size, float _smoothEdges){
    _size = vec2(0.5) - _size * 0.5;
    vec2 aa = vec2(_smoothEdges * 0.5);
    vec2 uv = smoothstep(_size, _size + aa, _st);
    uv *= smoothstep(_size, _size + aa, vec2(1.0) - _st);
    return uv.x * uv.y;
}     

uniform float2 iResolution;    
half4 main(float2 fragCoord) {
    vec2 st = fragCoord.xy / iResolution.xy;
    vec3 color = vec3(0.0);
    st = tile(st, 4.);
    color = vec3(box(st, vec2(0.7), 0.01));
    return vec4(color,1.0);
}</code>                                 
                            </div>
                        </li>
                                                
                        <li><strong>터틀 패턴 만들기</strong>                            
                            <div class="code-example">
                                <code>uniform float2 iResolution;
const float PI = 3.141592;
float2 rotate2D (vec2 _st, float _angle) {
    _st -= 0.5;
    _st =  mat2(cos(_angle),-sin(_angle),
                sin(_angle),cos(_angle)) * _st;
    _st += 0.5;
    return _st;
}

float2 tile (vec2 _st, float _zoom) {
    _st *= _zoom;
    return fract(_st);
}

float2 rotateTilePattern(float2 _st){
    //  Scale the coordinate system by 2x2
    _st *= 2.0;
    
    //  Give each cell an index number
    //  according to its position
    float index = 0.0;
    index += step(1., mod(_st.x, 2.0));
    index += step(1., mod(_st.y, 2.0)) * 2.0;

    //      |
    //  2   |   3
    //      |
    //--------------
    //      |
    //  0   |   1
    //      |
    // Make each cell between 0.0 - 1.0
    _st = fract(_st);
    // Rotate each cell according to the index
    if(index == 1.0){
        //  Rotate cell 1 by 90 degrees
        _st = rotate2D(_st,PI * 0.5);
    } else if(index == 2.0){
        //  Rotate cell 2 by -90 degrees
        _st = rotate2D(_st,PI * -0.5);
    } else if(index == 3.0) {
        //  Rotate cell 3 by 180 degrees
        _st = rotate2D(_st, PI);
    }
    return _st;
}

half4 main(float2 fragCoord) {
    vec2 st = fragCoord.xy / iResolution.xy;

    st = tile(st, 3.0);
    st = rotateTilePattern(st);

    // step(st.x,st.y) just makes a b&w triangles
    // but you can use whatever design you want.
    return half4(half3(step(st.x,st.y)), 1.0);
}
                                </code>                                 
                            </div>
                        </li>

                        <li><strong> Fractal, 회전,이동,스케일 행렬은 추후에 </strong></li>
                    </ul>
                </div>
            </div>

            <div class="lesson-content">
                <div class="editor-section">
                    <div class="section-header">SKSL 실습 코드</div>
                    <textarea class="code-editor" id="editor2">uniform float2 iResolution;
half4 main(float2 fragCoord) {
    return half4(1.0);
}</textarea>
                    <div class="controls">
                        <button class="btn" onclick="compileShader(2)">실행</button>
                    </div>
                </div>
                
                <div class="preview-section">
                    <div class="section-header">미리보기</div>
                    <div id="error2"></div>
                    <div class="preview-container">
                        <div class="loading" id="loading2">CanvasKit 로딩 중...</div>
                        <canvas class="preview-canvas" id="canvas2" width="300" height="300" style="display: none;"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleConcepts(conceptsId) {
            const content = document.getElementById(conceptsId);
            const icon = document.getElementById(`icon-${conceptsId}`);
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                content.style.maxHeight = content.scrollHeight + 'px';
                icon.textContent = '▲';
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('collapsed');
                content.style.maxHeight = '0';
                icon.textContent = '▼';
                icon.style.transform = 'rotate(0deg)';
            }
        }

        function toggleCode(codeId) {
            const content = document.getElementById(codeId);
            const toggle = document.getElementById(`toggle-${codeId}`);
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                content.style.maxHeight = '400px';
                toggle.textContent = '접기';
            } else {
                content.classList.add('collapsed');
                content.style.maxHeight = '0';
                toggle.textContent = '펼치기';
            }
        }

        // 초기 상태 설정
        // 초기 상태 설정
        document.addEventListener('DOMContentLoaded', function() {
            // concepts2, concepts3만 닫고 싶다면:
            const sectionsToClose = ['concepts1', 'concepts2', 'concepts3', 'concepts4', 'concepts5', 'concepts6', 'concepts7',
                'concepts8'
            ];
            
            sectionsToClose.forEach(conceptsId => {
                const content = document.getElementById(conceptsId);
                const icon = document.getElementById(`icon-${conceptsId}`);
                const header = document.querySelector(`[onclick="toggleConcepts('${conceptsId}')"]`);
                
                if (content) {
                    content.classList.add('collapsed');
                    content.style.maxHeight = '0';
                }
                if (icon) {
                    icon.textContent = '▼';
                }
                if (header) {
                    header.classList.add('closed');
                }
            });
        });

        // Placeholder functions for shader compilation
        function compileShader(id) {
            console.log(`Compiling shader ${id}...`);
            // 실제 셰이더 컴파일 로직이 여기에 들어갑니다
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/canvaskit-wasm/0.38.0/canvaskit.min.js"></script>
    <script src="shader-tutorial.js"></script>
</body>
</html>