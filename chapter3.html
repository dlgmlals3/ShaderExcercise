<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKSL 셰이더 교육 자료</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <h1> SKSL 셰이더 교육 자료</h1>
        <p> Chapter 2. 랜덤과 노이즈 </p>

        <nav class="chapter-nav">
            <a href="index.html" class="chapter-btn">Chapter 1. 기본 함수 및 기본 도형 그리기 </a>
            <a href="chapter2.html" class="chapter-btn">Chapter 2. 랜덤 함수와 노이즈 함수 </a>
            <a href="chapter3.html" class="chapter-btn active">Chapter 3. 이미지 필터링 및 활용 알고리즘 </a>
        </nav>
    </div>

    <div class="container">
        <div class="lesson">
            <div class="lesson-header">
                <div class="lesson-title"> 이미지 샘플링 해보기 </div>
                <div class="lesson-description">
                    <h3> 학습 목표</h3>
                    이미지 샘플링을 해보자. <br>

                    <h3> 랜덤 함수 (해시 함수) 생성 방법</h3>                        
                    
                </div>
            </div>

            <div class="key-concepts">
                <div class="concepts-header" onclick="toggleConcepts('concepts5')">
                    <h4> 이미지 샘플링 </h4><br>                          
                    <span class="toggle-icon" id="icon-concepts5">▼</span>
                </div>        

                <div class="concepts-content" id="concepts5">
                    <ul>                       
                        <img src="materials/chapter3/image.png" alt="circle" style="max-width: 100%; height: auto; margin-bottom: 10px;"><br>
                        <li><strong> 이미지 샘플링 함수 </strong><br>
                            <div class="code-example">                     
<code>uniform float2 iResolution;
uniform shader iTexture;
half4 main(float2 fragCoord) {
    float2 uv = fragCoord / iResolution;
    return iTexture.eval(uv * iResolution);
}
</code>
                            </div>
                        </li>                        
                    </ul>
                    <ul>                       
                        <li><strong> 이미지 샘플링 함수 </strong><br>
                            <div class="code-example">                     
<code>uniform float2 iResolution;
uniform float  iTime;
uniform shader iTexture;
float PI = 3.141592;

float random (in vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
}

float noise (in vec2 st) {
    vec2 i = floor(st);
    vec2 f = fract(st);

    // Four corners in 2D of a tile
    float a = random(i);
    float b = random(i + vec2(1.0, 0.0));
    float c = random(i + vec2(0.0, 1.0));
    float d = random(i + vec2(1.0, 1.0));

    vec2 u = f * f * (3.0 - 2.0 * f);

    return mix(a, b, u.x) +
            (c - a)* u.y * (1.0 - u.x) +
            (d - b) * u.x * u.y;
}

half4 main (float2 fragcoord) {
    vec2 st = fragcoord.xy/iResolution.xy;

    float scale = 2.0;
    float offset = 0.5;

    float angle = noise( st + iTime * 0.1 ) * PI;
    float radius = offset;

    st *= scale;
    st += radius * vec2(cos(angle),sin(angle));
    
    vec4 color = iTexture.eval(st * iResolution);
    return color;
}
</code>
                            </div>
                        </li>                        
                    </ul>
                </div>
            </div>

            <div class="key-concepts">
                <div class="concepts-header" onclick="toggleConcepts('concepts6')">
                    <h4> 컬러 필터 알고리즘 </h4><br>                          
                    <span class="toggle-icon" id="icon-concepts6">▼</span>
                </div>        

                <div class="concepts-content" id="concepts6">
                    <ul>                       
                        <li><strong> 흑백 필터 </strong><br>
                            <div class="code-example">                     
<code>uniform float2 iResolution;
uniform shader iTexture;

half4 main(float2 fragCoord) {
    float2 uv = fragCoord / iResolution;
    // 원본 색
    half4 c = iTexture.eval(uv * iResolution);
    // 가중합으로 밝기 구하기 (sRGB 기준)
    half gray = dot(c.rgb, half3(0.299, 0.587, 0.114));
    // 흑백으로 리턴
    return half4(gray, gray, gray, c.a);
}
</code>
                            </div>
                        </li>                        
                    </ul>
                    <ul>                       
                        <li><strong> Invert </strong><br>
                            <div class="code-example">                     
<code>uniform float2 iResolution;
uniform shader iTexture;

half4 main(float2 fragCoord) {
    float2 uv = fragCoord / iResolution;
    half4 c = iTexture.eval(uv * iResolution);
    return half4(1.0 - c.rgb, c.a);
}
</code>
                            </div>
                        </li>                        
                    </ul>
                    <ul>                       
                        <li><strong> Tint </strong><br>
                            <div class="code-example">                     
<code>uniform float2 iResolution;
uniform shader iTexture;
float3 tint = float3(1, 0, 0);  // (1,0,0) = red tint
float  amount = 1;

half4 main(float2 fragCoord) {
    float2 uv = fragCoord / iResolution;
    half4 c = iTexture.eval(uv * iResolution);
    c.rgb = mix(c.rgb, c.rgb * tint, amount);
    return c;
}
</code>
                            </div>
                        </li>                        
                    </ul>
                    <ul>                       
                        <li><strong> Color Curve </strong><br>
                            <div class="code-example">                     
<code>uniform float2 iResolution;
uniform shader iTexture;

// 각 채널 y값 (x는 0,1/3,2/3,1 고정)
float4 curveRY = float4(0.3, 0.2, 0.5, 0.1); // y0,y1,y2,y3 for R
float4 curveGY = float4(0.3, 0.3, 0.5, 0.1);
float4 curveBY = float4(0.3, 0.2, 0.5, 0.1);

half catmull(float p0, float p1, float p2, float p3, float t) {
    // 표준 Catmull-Rom (tension=0.5 근사; 여기선 표준계수)
    float t2 = t*t, t3 = t2*t;
    return 0.5 * ( (2.0*p1) +
                   (-p0 + p2) * t +
                   (2.0*p0 - 5.0*p1 + 4.0*p2 - p3) * t2 +
                   (-p0 + 3.0*p1 - 3.0*p2 + p3) * t3 );
}

half evalCurve(float x, float4 y) {
    x = clamp(x, 0.0, 1.0);
    // 구간: [0,1/3],[1/3,2/3],[2/3,1]
    if (x < 1.0/3.0) {
        float t = x * 3.0;
        // (p0=extrap y0, p1=y0, p2=y1, p3=y2) → 양끝은 y0, y3로 복제
        return catmull(y.x, y.x, y.y, y.z, t);
    } else if (x < 2.0/3.0) {
        float t = x * 3.0 - 1.0;
        return catmull(y.x, y.y, y.z, y.w, t);
    } else {
        float t = x * 3.0 - 2.0;
        return catmull(y.y, y.z, y.w, y.w, t);
    }
}

half3 applyCurve(half3 c) {
    half r = saturate( evalCurve(c.r, curveRY) );
    half g = saturate( evalCurve(c.g, curveGY) );
    half b = saturate( evalCurve(c.b, curveBY) );
    return half3(r,g,b);
}

half4 main(float2 fragCoord) {
    float2 uv = fragCoord / iResolution;
    half4 c = iTexture.eval(uv * iResolution);
    half3 o = applyCurve(c.rgb);
    return half4(o, c.a);
}
</code>
                            </div>
                        </li>                        
                    </ul>
                </div>
            </div>
            <div class="lesson-content">
                <div class="editor-section">
                    <div class="section-header">SKSL 코드</div>
                    <textarea class="code-editor" id="editor3">
uniform float2 iResolution;
uniform shader iTexture;
half4 main(float2 fragCoord) {
    float2 uv = fragCoord / iResolution;
    return iTexture.eval(uv * iResolution);
}
</textarea>
                    <div class="controls">
                        <button class="btn" onclick="compileShader(3)">실행</button>
                    </div>
                </div>

                <div class="preview-section">
                    <div class="section-header">미리보기</div>
                    <div id="error3"></div>
                    <div class="preview-container">
                        <div class="loading" id="loading3">CanvasKit 로딩 중...</div>
                        <canvas class="preview-canvas" id="canvas3" width="300" height="300" style="display: none;"></canvas>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        function toggleConcepts(conceptsId) {
            const content = document.getElementById(conceptsId);
            const icon = document.getElementById(`icon-${conceptsId}`);
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                content.style.maxHeight = content.scrollHeight + 'px';
                icon.textContent = '▲';
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('collapsed');
                content.style.maxHeight = '0';
                icon.textContent = '▼';
                icon.style.transform = 'rotate(0deg)';
            }
        }

        function toggleCode(codeId) {
            const content = document.getElementById(codeId);
            const toggle = document.getElementById(`toggle-${codeId}`);
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                content.style.maxHeight = '400px';
                toggle.textContent = '접기';
            } else {
                content.classList.add('collapsed');
                content.style.maxHeight = '0';
                toggle.textContent = '펼치기';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // concepts2, concepts3만 닫고 싶다면:
            const sectionsToClose = ['concepts1', 'concepts2', 'concepts3', 'concepts4', 'concepts5', 'concepts6', 'concepts7',
                'concepts8'
            ];
            
            sectionsToClose.forEach(conceptsId => {
                const content = document.getElementById(conceptsId);
                const icon = document.getElementById(`icon-${conceptsId}`);
                const header = document.querySelector(`[onclick="toggleConcepts('${conceptsId}')"]`);
                
                if (content) {
                    content.classList.add('collapsed');
                    content.style.maxHeight = '0';
                }
                if (icon) {
                    icon.textContent = '▼';
                }
                if (header) {
                    header.classList.add('closed');
                }
            });
        });

        // Placeholder functions for shader compilation
        function compileShader(id) {
            console.log(`Compiling shader ${id}...`);
            // 실제 셰이더 컴파일 로직이 여기에 들어갑니다
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/canvaskit-wasm/0.38.0/canvaskit.min.js"></script>
    <script src="shader-tutorial.js"></script>
</body>
</html>