<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKSL 셰이더 교육 자료</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <h1> SKSL 셰이더 교육 자료</h1>
        <p>Chapter 2. 기본 도형 회전 이동 확대 </p>

        <nav class="chapter-nav">
            <a href="index.html" class="chapter-btn"> 0. 기본 함수 설명 </a>
            <a href="chapter1.html" class="chapter-btn">1. 기본 도형과 패턴
            <a href="chapter2.html" class="chapter-btn active">2. 기본 도형 회전 이동 확대
            <a href="chapter3.html" class="chapter-btn">3. 랜덤 함수와 노이즈 함수 </a><br>
            <a href="chapter4.html" class="chapter-btn">4. Fractal </a>
            <a href="chapter5.html" class="chapter-btn">5. 이미지 필터링 및 컬러 커브 </a>
            <a href="chapter6.html" class="chapter-btn">6. 블러 알고리즘 </a>
        </nav>
    </div>

    <div class="container">
        <div class="lesson">
            <div class="lesson-header">
                <div class="lesson-title"> 기본 도형 회전 이동 확대</div>
                <div class="lesson-description">
                    <h3> 학습 목표</h3>
                    기본 도형인 원과 사각형을 RTS를 적용해보자..<br><br>
                    Assignment<br>
                    1) 원을 우측에 더 그려보자. <br>
                    2) 사각형의 영역을 확인해보자 <br>
                </div>
            </div>
            
            <div class="key-concepts">
                <div class="concepts-header" onclick="toggleConcepts('concepts2')">
                    <h4>기본 도형 만들기</h4>
                    <span class="toggle-icon" id="icon-concepts2">▼</span>
                </div>
                <div class="concepts-content" id="concepts2">
                    <ul>
                        <li><strong><h5>원리</h5></strong><br>
                        <img src="materials/chapter2/circle.png" alt="circle" style="max-width: 100%; height: auto; margin-bottom: 10px;">
                        <img src="materials/chapter2/box4.png" alt="circle" style="max-width: 100%; height: auto; margin-bottom: 10px;">
                        <li><strong>정규화</strong><br>
                            <div class="code-example">
                                <code>float2 uv = fragCoord / iResolution.xy;</code>
                            </div>
                        </li>

                        <li><strong>원을 만드는 코드</strong>                                                        
                            <div class="code-example">
                                <code>uniform float2 iResolution;
float circle(in vec2 _st, in float _radius) {     
    return 1. - smoothstep(_radius - (_radius * 0.01), 
                          _radius + (_radius * 0.01), 
                          dot(_st, _st) * 2.0);
}
half4 main(float2 fragCoord) {
    float2 uv = (fragCoord / iResolution.xy) - .5;    
    float color = circle(uv, 0.3);
    return half4(color, 0, 0, 1.0);
}</code>                             
                            </div>
                        </li>
                        <li><strong>박스 만드는 코드</strong>      
                            <div class="code-example">                                
<code>vec2 tile(vec2 _st, float _zoom) {
    _st *= _zoom;
    return fract(_st);
}

float box(vec2 _st, vec2 _size, float _smoothEdges){
    _size = vec2(0.5) - _size * 0.5;
    vec2 aa = vec2(_smoothEdges * 0.5);
    vec2 uv = smoothstep(_size, _size + aa, _st);
    uv *= smoothstep(_size, _size + aa, vec2(1.0) - _st);
    return uv.x * uv.y;
}     

uniform float2 iResolution;    
half4 main(float2 fragCoord) {
    vec2 st = fragCoord.xy / iResolution.xy;
    vec3 color = vec3(0.0);
    st = tile(st, 4.);
    color = vec3(box(st, vec2(0.7), 0.01));
    return vec4(color,1.0);
}</code>                                 
                            </div>
                        </li>                    
                    </ul>
                </div>
                
            </div>

            <div class="key-concepts">
                <div class="concepts-header" onclick="toggleConcepts('concepts3')">
                    <h4>Rotation </h4>
                    <span class="toggle-icon" id="icon-concepts3">▼</span>                      
                </div>
                <div class="concepts-content" id="concepts3">
                    <ul>                      
                        <li><strong><h3>Rotation 1</h3></strong>
                        rotate2d() 함수 참조.<br>
                        <img src="materials/chapter2/2dmatrics.png" alt="circle" style="max-width: 100%; height: auto; margin-bottom: 10px;"> <br>
                        1. 함수의 인자는 라디안 단위(PI)<br>
                        uv = rotate2d(<회전 속도> * 2 * PI) * uv;<br><br>

                        
                        2. 회전 속도는 일정한 영역 사이의 값으로 정규화해서 사용<br>
                        - iTime변수를 fract, sin, cos 함수 인자로 넣어 사용.<br><br>
                        
                        3. 회전은 원점(0,0)을 기준으로 회전한다.<br>
                        물체의 회전 축이 원점이 아닌 경우, 원점을 기준으로 물체가 공전하게 된다.<br>
                        물체를 물체의 중심 축으로 부터 자전하기 위해서는, 물체의 중심좌표로 좌표계를 이동 후 회전을 적용 하고 다시 원복한다.<br>
                        <img src="materials/chapter2/rotationCoord1.png" alt="circle" style="max-width: 100%; height: auto; margin-bottom: 10px;"> <br>

                            <div class="code-example">
                                <code>uniform float2 iResolution;
uniform float  iTime;

mat2 rotate2d(float _angle){
    return mat2(cos(_angle),-sin(_angle),
                sin(_angle),cos(_angle));
}

float box(vec2 uv, vec2 center, vec2 size){
    vec2 st = step(center - size, uv) * (1. - step(center + size, uv));
    return st.x * st.y;
}     

half4 main(float2 fragCoord) {
    float PI = 3.141592;
    float2 uv = (fragCoord / iResolution.xy);    
    uv.y = 1. - uv.y;
    //uv -= .5;
    //uv = rotate2d(fract(iTime * .2) * 2 * PI) * uv;
    //uv += .5;
    float color = box(uv, vec2(.5, .5), vec2(0.1));

    return half4(color, 0, 0, 1.0);
}</code>                             
                            </div>
                        </li>

                        <li><strong> Rotation 2 (자전) </strong> <br>                                                     
                        정규화를 -1 ~ 1 로 바꿔서 원점 기준 회전.<br>
                        이런 경우 회전 중심을 바꿀필요가 없기 때문에 원하는 위치에 사각형을 그리기 위해서 <br>
                        rotation함수 전 uv좌표를 이동시키면 됨. <br>
                        
                        <div class="code-example">
                        <code>uniform float2 iResolution;
uniform float  iTime;

mat2 rotate2d(float _angle){
    return mat2(cos(_angle),-sin(_angle),
                sin(_angle),cos(_angle));
}

float box(vec2 uv, vec2 center, vec2 size){
    vec2 st = step(center - size, uv) * (1. - step(center + size, uv));
    return st.x * st.y;
}     

half4 main(float2 fragCoord) {
    float PI = 3.141592;
    float2 uv = (fragCoord / iResolution.xy);    
    uv.y = 1. - uv.y;
    uv *= 2.;
    uv -= 1.;
    
    //uv -= .5;
    //uv = rotate2d(fract(iTime * .2) * 2 * PI) * uv;
    float color = box(uv, vec2(0, 0), vec2(0.1));

    return half4(color, 0, 0, 1.0);
}</code>                             
                            </div>
                        </li>

                        <li><strong>Rotation 3 (자전 + 공전)</strong><br>
                            <div class="code-example">
                                <code>uniform float2 iResolution;
uniform float  iTime;

mat2 rotate2d(float _angle){
    return mat2(cos(_angle),-sin(_angle),
                sin(_angle),cos(_angle));
}

float box(vec2 uv, vec2 center, vec2 size){
    vec2 st = step(center - size, uv) * (1. - step(center + size, uv));
    return st.x * st.y;
}     

half4 main(float2 fragCoord) {
    float PI = 3.141592;
    float2 uv = (fragCoord / iResolution.xy);    
    uv.y = 1. - uv.y;
    uv *= 2.;
    uv -= 1.;
    
    // Rotation from origin
    //uv = rotate2d(fract(iTime * .2) * 2 * PI) * uv;
    //uv -= .5;

    // Rotation from object
    uv = rotate2d(fract(iTime * .2) * 2 * PI) * uv;

    float color = box(uv, vec2(0, 0), vec2(0.1));

    return half4(color, 0, 0, 1.0);
}</code>                             
                            </div>
                        </li>
                    </ul>
                </div>
                
            </div>

            <div class="key-concepts">
                <div class="concepts-header" onclick="toggleConcepts('concepts4')">
                    <h4>Transition And Scale</h4>
                    <span class="toggle-icon" id="icon-concepts4">▼</span>                      
                </div>
                <div class="concepts-content" id="concepts4">
                    <ul>                      
                        <li><strong>Translation</strong><br>                                        
                            x, y 이동 offset 2d vector <br>
                            <div class="code-example">
                                <code>uniform float2 iResolution;
uniform float  iTime;
float circle(in vec2 _st, in float _radius) {     
    return 1. - smoothstep(_radius - (_radius * 0.01), 
                          _radius + (_radius * 0.01), 
                          dot(_st, _st) * 2.0);
}
half4 main(float2 fragCoord) {
    float2 uv = (fragCoord / iResolution.xy) - .5;    
    
    vec2 translate = vec2(cos(iTime),sin(iTime));
    //translate = vec2(0.3, 0.0);
    //uv += translate * 0.35;

    float color = circle(uv, 0.1);
    return half4(color, 0, 0, 1.0);
}</code>                             
                            </div>
                        </li>
                        
                        <li><strong>Scale</strong>        
                            스케일 벡터의 행렬은 대각선 성분에 스케일 값이 들어감.<br>                                            
                            <div class="code-example">
                                <code>uniform float2 iResolution;
uniform float  iTime;
mat2 scale(vec2 _scale){
    return mat2(_scale.x, 0.0, 0.0,_scale.y);
}

float circle(in vec2 _st, in float _radius) {     
    return 1. - smoothstep(_radius - (_radius * 0.01), 
                          _radius + (_radius * 0.01), 
                          dot(_st, _st) * 2.0);
}
half4 main(float2 fragCoord) {
    float2 uv = (fragCoord / iResolution.xy) - .5;    
    //uv *= scale(vec2(sin(iTime), sin(iTime)));

    float color = circle(uv, 0.1);

    return half4(color, 0., 0., 1.0);
}</code>                             
                            </div>
                        </li>
                    </ul>
                </div>                
            </div>

            <div class="lesson-content">
                <div class="editor-section">
                    <div class="section-header">SKSL 실습 코드</div>
                    <textarea class="code-editor" id="editor2">uniform float2 iResolution;
half4 main(float2 fragCoord) {
    return half4(1.0);
}</textarea>
                    <div class="controls">
                        <button class="btn" onclick="compileShader(2)">실행</button>
                    </div>
                </div>
                
                <div class="preview-section">
                    <div class="section-header">미리보기</div>
                    <div id="error2"></div>
                    <div class="preview-container">
                        <div class="loading" id="loading2">CanvasKit 로딩 중...</div>
                        <canvas class="preview-canvas" id="canvas2" width="300" height="300" style="display: none;"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleConcepts(conceptsId) {
            const content = document.getElementById(conceptsId);
            const icon = document.getElementById(`icon-${conceptsId}`);
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                content.style.maxHeight = content.scrollHeight + 'px';
                icon.textContent = '▲';
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('collapsed');
                content.style.maxHeight = '0';
                icon.textContent = '▼';
                icon.style.transform = 'rotate(0deg)';
            }
        }

        function toggleCode(codeId) {
            const content = document.getElementById(codeId);
            const toggle = document.getElementById(`toggle-${codeId}`);
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                content.style.maxHeight = '400px';
                toggle.textContent = '접기';
            } else {
                content.classList.add('collapsed');
                content.style.maxHeight = '0';
                toggle.textContent = '펼치기';
            }
        }

        // 초기 상태 설정
        // 초기 상태 설정
        document.addEventListener('DOMContentLoaded', function() {
            // concepts2, concepts3만 닫고 싶다면:
            const sectionsToClose = ['concepts1', 'concepts2', 'concepts3', 'concepts4', 'concepts5', 'concepts6', 'concepts7',
                'concepts8'
            ];
            
            sectionsToClose.forEach(conceptsId => {
                const content = document.getElementById(conceptsId);
                const icon = document.getElementById(`icon-${conceptsId}`);
                const header = document.querySelector(`[onclick="toggleConcepts('${conceptsId}')"]`);
                
                if (content) {
                    content.classList.add('collapsed');
                    content.style.maxHeight = '0';
                }
                if (icon) {
                    icon.textContent = '▼';
                }
                if (header) {
                    header.classList.add('closed');
                }
            });
        });

        // Placeholder functions for shader compilation
        function compileShader(id) {
            console.log(`Compiling shader ${id}...`);
            // 실제 셰이더 컴파일 로직이 여기에 들어갑니다
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/canvaskit-wasm/0.38.0/canvaskit.min.js"></script>
    <script src="shader-tutorial.js"></script>
</body>
</html>